<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Expert Assistant | Tempo Ops</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Load Montserrat Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    colors: {
                        'tempo-indigo': '#485484', 
                        'tempo-gold': '#c6a777',   
                        'tempo-orange': '#ef6d4f',
                        'tempo-red': '#f46d6d',
                        'tempo-green': '#10b981'
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        body { 
            font-family: 'Montserrat', sans-serif; 
            -webkit-font-smoothing: antialiased;
        }
        
        .prose-custom { 
            color: #030712; 
            line-height: 1.7;
        }
        .dark .prose-custom { color: #f3f4f6; }

        #recommendationText h2, #smsText h2 {
            font-weight: 700;
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #000000;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        #recommendationText h3, #smsText h3 {
            font-weight: 600;
            font-size: 1rem;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
            color: #111827;
        }

        .dark #recommendationText h2, .dark #recommendationText h3, 
        .dark #smsText h2, .dark #smsText h3 { color: #ffffff; border-color: #374151; }

        #recommendationText strong, #smsText strong {
            color: #000000; 
            font-weight: 700;
        }
        .dark #recommendationText strong, .dark #smsText strong { color: #ffffff; }

        #recommendationText a {
            color: #485484;
            font-weight: 700;
            text-decoration: underline;
            text-underline-offset: 3px;
            transition: all 0.2s ease;
        }
        #recommendationText a:hover { color: #10b981; }
        .dark #recommendationText a { color: #c6a777; }

        .tab-active {
            border-color: #485484;
            color: #485484;
            font-weight: 700;
        }
        .dark .tab-active {
            border-color: #c6a777;
            color: #c6a777;
        }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-gray-900 min-h-screen flex items-center justify-center p-4 transition-colors duration-300">

    <div class="bg-white dark:bg-gray-800 w-full max-w-7xl rounded-3xl shadow-2xl flex flex-col md:flex-row overflow-hidden h-[92vh] transition-colors duration-300 border border-slate-200 dark:border-gray-700">
        
        <!-- Sidebar / Inputs -->
        <div class="w-full md:w-1/3 bg-slate-50/50 dark:bg-gray-900/40 p-8 border-r border-slate-200 dark:border-gray-700 flex flex-col overflow-y-auto">
            <div class="mb-10">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <img src="https://tempo.fit/_next/image?url=https%3A%2F%2Fwww.datocms-assets.com%2F135987%2F1758652384-image-5-photoroom-2.jpeg&w=1920&q=80" alt="Tempo Logo" class="h-7 w-auto">
                        <h1 class="text-base font-bold text-gray-900 dark:text-white tracking-tight uppercase">Fitness Ops</h1>
                    </div>
                    <button id="theme-toggle" class="p-2.5 rounded-2xl bg-white dark:bg-gray-800 shadow-sm border border-slate-200 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-slate-50 transition-all">
                        <svg id="sun-icon" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                        <svg id="moon-icon" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                    </button>
                </div>
            </div>

            <div class="space-y-8 flex-grow">
                <div>
                    <label class="block text-[11px] font-bold text-slate-400 uppercase tracking-[0.15em] mb-3">Member Goals</label>
                    <textarea id="goals" rows="3" class="w-full p-4 text-sm border-2 border-slate-200 dark:border-gray-700 rounded-2xl bg-white dark:bg-gray-800 text-gray-900 dark:text-white outline-none resize-none focus:border-tempo-indigo transition-colors" placeholder="e.g. Weight loss + Strength"></textarea>
                </div>
                
                <div>
                    <label class="block text-[11px] font-bold text-slate-400 uppercase tracking-[0.15em] mb-3">Lifestyle & Equipment</label>
                    <textarea id="preferences" rows="3" class="w-full p-4 text-sm border-2 border-slate-200 dark:border-gray-700 rounded-2xl bg-white dark:bg-gray-800 text-gray-900 dark:text-white outline-none resize-none focus:border-tempo-indigo transition-colors" placeholder="e.g. 20 mins, dumbbells only"></textarea>
                </div>

                <div>
                    <label class="block text-[11px] font-bold text-slate-400 uppercase tracking-[0.15em] mb-3">Symptoms</label>
                    <textarea id="symptoms" rows="3" class="w-full p-4 text-sm border-2 border-slate-200 dark:border-gray-700 rounded-2xl bg-white dark:bg-gray-800 text-gray-900 dark:text-white outline-none resize-none focus:border-tempo-indigo transition-colors" placeholder="e.g. Back pain"></textarea>
                </div>
            </div>

            <div class="mt-10">
                <button id="generate-btn" class="w-full bg-tempo-indigo text-white font-bold py-4 px-6 rounded-2xl shadow-lg hover:bg-tempo-green hover:shadow-tempo-green/20 hover:-translate-y-0.5 active:translate-y-0 transition-all flex justify-center items-center group">
                    <span id="btn-text">GENERATE HYBRID PLAN</span>
                    <span id="loading-spinner" class="hidden ml-3">
                        <svg class="animate-spin h-5 w-5 text-white" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    </span>
                </button>
            </div>
        </div>

        <!-- Main Display -->
        <div class="w-full md:w-2/3 flex flex-col bg-white dark:bg-gray-800 relative">
            <div id="tabs-header" class="hidden flex-shrink-0 border-b border-slate-100 dark:border-gray-700 bg-white dark:bg-gray-800 z-10">
                <nav class="flex space-x-10 px-10">
                    <button id="tab-recommendation" class="tab-active whitespace-nowrap py-6 px-1 border-b-2 text-[11px] font-bold tracking-wider transition-all uppercase">
                        Master Strategy
                    </button>
                    <button id="tab-sms" class="border-transparent text-slate-400 dark:text-gray-500 hover:text-slate-600 whitespace-nowrap py-6 px-1 border-b-2 font-semibold text-[11px] tracking-wider transition-all uppercase">
                        Coach Melissa Drafts
                    </button>
                </nav>
            </div>

            <div class="flex-grow overflow-y-auto p-8 md:p-12 relative">
                <div id="welcome-state" class="h-full flex flex-col items-center justify-center text-center space-y-6">
                    <div class="p-6 bg-slate-50 dark:bg-gray-900/50 rounded-full text-tempo-indigo">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 opacity-30" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                    <div class="max-w-xs space-y-2">
                        <h2 class="text-lg font-bold text-slate-900 dark:text-white uppercase tracking-wider">Expert Orchestrator</h2>
                        <p class="text-sm text-slate-400 font-medium leading-relaxed">Enter member data to generate training plans from our official program list, compliant with SOP guidelines.</p>
                    </div>
                </div>

                <div id="error-message" class="hidden bg-red-50 dark:bg-red-900/20 border border-red-200 p-6 rounded-2xl mb-8 flex items-start space-x-4 text-red-700 dark:text-red-300 font-medium">
                    <svg class="h-5 w-5 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>
                    <span id="error-text" class="text-xs leading-relaxed"></span>
                </div>

                <div id="content-recommendation" class="hidden">
                    <div id="recommendationText" class="prose-custom max-w-none pb-20"></div>
                </div>

                <div id="content-sms" class="hidden">
                    <div class="bg-indigo-50/30 dark:bg-indigo-900/10 border border-indigo-100 dark:border-indigo-900/30 p-8 rounded-3xl mb-12">
                        <p class="text-[10px] font-bold text-tempo-indigo dark:text-tempo-gold uppercase tracking-[0.2em] mb-2">Voice: Coach Melissa</p>
                        <p class="text-xs text-slate-500 dark:text-gray-400 font-medium leading-relaxed italic">Friendly, program-focused snippets for member SMS. Never contains internal wiki links.</p>
                    </div>
                    <div id="smsText" class="prose-custom max-w-none pb-20"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        const generateBtn = document.getElementById('generate-btn');
        const btnText = document.getElementById('btn-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const welcomeState = document.getElementById('welcome-state');
        const tabsHeader = document.getElementById('tabs-header');
        const goalsInput = document.getElementById('goals');
        const preferencesInput = document.getElementById('preferences');
        const symptomsInput = document.getElementById('symptoms');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const contentRecommendation = document.getElementById('content-recommendation');
        const contentSms = document.getElementById('content-sms');
        const recommendationText = document.getElementById('recommendationText');
        const smsText = document.getElementById('smsText');
        const tabRecBtn = document.getElementById('tab-recommendation');
        const tabSmsBtn = document.getElementById('tab-sms');
        const themeToggle = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');

        // --- THEME ---
        const setDark = (isDark) => {
            document.documentElement.classList.toggle('dark', isDark);
            sunIcon.classList.toggle('hidden', isDark);
            moonIcon.classList.toggle('hidden', !isDark);
            localStorage.theme = isDark ? 'dark' : 'light';
        };
        const initialDark = localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
        setDark(initialDark);
        themeToggle.onclick = () => setDark(!document.documentElement.classList.contains('dark'));

        // --- TABS ---
        function switchTab(tab) {
            contentRecommendation.classList.toggle('hidden', tab !== 'recommendation');
            contentSms.classList.toggle('hidden', tab !== 'sms');
            tabRecBtn.className = tab === 'recommendation' ? "tab-active whitespace-nowrap py-6 px-1 border-b-2 text-[11px] font-bold tracking-wider transition-all uppercase" : "border-transparent text-slate-400 dark:text-gray-500 hover:text-slate-600 whitespace-nowrap py-6 px-1 border-b-2 font-semibold text-[11px] tracking-wider transition-all uppercase";
            tabSmsBtn.className = tab === 'sms' ? "tab-active whitespace-nowrap py-6 px-1 border-b-2 text-[11px] font-bold tracking-wider transition-all uppercase" : "border-transparent text-slate-400 dark:text-gray-500 hover:text-slate-600 whitespace-nowrap py-6 px-1 border-b-2 font-semibold text-[11px] tracking-wider transition-all uppercase";
        }
        tabRecBtn.onclick = () => switchTab('recommendation');
        tabSmsBtn.onclick = () => switchTab('sms');

        // --- KNOWLEDGE BASE ---
        const knowledgeBase = {
            sopsLinks: {
                "Get Strong SOP": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1385693249/Get+Strong",
                "Improve Definition SOP": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1387855920/Improve+definition",
                "Lose Weight SOP": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1387397155/Lose+Weight+and+Getting+Healthier",
                "Injuries Inquiries SOP": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1387397209/Injuries+Inquiries",
                "Fitness Tips": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1388281898/Fitness+Tips",
                "General Fitness Inquiries": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1385955438/General+Fitness+Inquiries",
                "Tempo Blog": "https://tempo.fit/blog"
            },
            programs: [
                 { name: "Foundations of Growth", goal: "Gain Strength", coach: "Alex", level: "Intermediate", description: "Perfect your form and grow muscles." },
                 { name: "Build & Burn", goal: "Gain Strength & Cardio", coach: "Melissa", level: "Beginner", description: "Low-impact cardio and strength." },
                 { name: "Metabolic Meltdown", goal: "Lose Weight", coach: "Melissa", level: "Intermediate", description: "Boost metabolism and build strength." },
                 { name: "Sculpt & Shred", goal: "Improve Definition", coach: "Colby", level: "Advanced", description: "Fat loss + muscle maintenance." },
                 { name: "10 Day Yoga Reset", goal: "Recovery & Breathing", coach: "Jeremy", level: "Beginner", description: "Reset the nervous system." },
                 { name: "Complete Core", goal: "Core Strength", coach: "Bryan", level: "Intermediate", description: "Sculpt a powerful core." },
                 { name: "Max Intensity", goal: "Lose Weight", coach: "Melissa", level: "Advanced", description: "High-intensity cardio." },
                 { name: "Off-Season Athlete", goal: "Performance", coach: "Melissa", level: "Advanced", description: "Strength, speed, and agility." }
            ]
        };

        const systemPrompt = `
You are the "Tempo Expert Orchestrator". 
Mission: Recommend actual Tempo programs and classes from the official list provided.

LOGIC RULES:
1. **Source of Recommendation**: Your recommendations MUST be specific Tempo programs (e.g., 'Metabolic Meltdown', 'Foundations of Growth') from the provided list.
2. **Backend Logic (SOPs)**: Use the Tempo SOPs to ensure your choice is compliant (e.g., if knee pain is mentioned, use logic from the 'Injuries Inquiries SOP' to suggest low-impact classes). 
3. **Safety Disclaimer**: Start every response with the mandatory medical disclaimer.
4. **Mandatory Elements**: Every plan must include a warm-up and cool-down.
5. **Agent Hyperlinking**: In the Strategy section, hyperlink all mentioned SOP names to their URLs.
6. **Coach Melissa SMS**: 
   - NEVER hyperlink SOPs in the SMS section. 
   - Focus on mentioning the programs and how they help with the member's goals.

FORMAT:
[The Disclaimer]
## Training Strategy Overview
## Recommended Training Programs (Tempo Official Content)
## Weekly Hybrid Schedule (Classes & Programs)
## Logic & Compliance (SOP References for Agent - Hyperlink SOPs here)
---SMS_SECTION---
## Snippet 1: The Opener
## Snippet 2: The Plan (Plain Text)
## Snippet 3: Motivational Wrap-up
`;

        function isInputValid(g, p, s) {
            const combined = (g + p + s).toLowerCase();
            const consonantsOnly = /^[^aeiouy]+$/i.test(combined.replace(/[^a-z]/g, ''));
            const tooShort = combined.length < 8;
            return !(tooShort || consonantsOnly);
        }

        generateBtn.onclick = async () => {
            const goals = goalsInput.value.trim();
            const prefs = preferencesInput.value.trim();
            const symptoms = symptomsInput.value.trim();
            errorMessage.classList.add('hidden');

            if (!isInputValid(goals, prefs, symptoms)) {
                errorText.textContent = "Please submit sufficient data from the client's case (goals, actual symptoms, and lifestyle) to allow for a professional recommendation.";
                errorMessage.classList.remove('hidden');
                return;
            }

            setLoading(true);
            try {
                const apiKey = "AIzaSyAbWuPoQiq9oBP_6HRxpTPWOfwo-6y3GBE"; 
                const model = "gemini-2.5-flash-preview-09-2025";
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `GOALS: ${goals}\nLIFESTYLE: ${prefs}\nSYMPTOMS: ${symptoms}` }] }],
                        systemInstruction: { parts: [{ text: systemPrompt + JSON.stringify(knowledgeBase) }] },
                        tools: [{ "google_search": {} }]
                    })
                });
                
                if (!response.ok) throw new Error(`API Error ${response.status}`);
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) throw new Error("No response generated.");

                const [rec, sms] = text.split('---SMS_SECTION---');
                recommendationText.innerHTML = marked.parse(rec || "");
                smsText.innerHTML = marked.parse(sms || "");
                welcomeState.classList.add('hidden');
                tabsHeader.classList.remove('hidden');
                switchTab('recommendation');
            } catch (error) {
                errorText.textContent = error.message;
                errorMessage.classList.remove('hidden');
            } finally {
                setLoading(false);
            }
        };

        function setLoading(isLoading) {
            generateBtn.disabled = isLoading;
            btnText.textContent = isLoading ? "ORCHESTRATING..." : "GENERATE HYBRID PLAN";
            loadingSpinner.classList.toggle('hidden', !isLoading);
        }
    </script>
</body>
</html>
