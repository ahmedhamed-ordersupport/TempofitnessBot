<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Expert Assistant | Tempo Ops</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Load Montserrat Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    colors: {
                        'tempo-indigo': '#485484', 
                        'tempo-gold': '#c6a777',   
                        'tempo-orange': '#ef6d4f',
                        'tempo-red': '#f46d6d',
                        'tempo-green': '#10b981' // Green for hover states
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        body { 
            font-family: 'Montserrat', sans-serif; 
            -webkit-font-smoothing: antialiased;
        }
        
        /* High contrast for light mode - Deep Black */
        .prose-custom { 
            color: #030712; 
            line-height: 1.6;
        }
        .dark .prose-custom { color: #f3f4f6; }

        #recommendationText pre, #smsText pre {
            background-color: #f8fafc;
            padding: 1.25rem;
            border-radius: 0.75rem;
            white-space: pre-wrap;
            overflow-x: auto;
            border: 1px solid #e2e8f0;
        }
        .dark #recommendationText pre, .dark #smsText pre {
            background-color: #111827;
            border-color: #374151;
        }
        
        #recommendationText h2, #smsText h2 {
            font-weight: 700;
            font-size: 1.4rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #000000;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 0.25rem;
        }

        #recommendationText h3, #smsText h3 {
            font-weight: 700;
            font-size: 1.1rem;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: #000000;
        }
        .dark #recommendationText h2, .dark #recommendationText h3, 
        .dark #smsText h2, .dark #smsText h3 { color: #ffffff; border-color: #374151; }

        #recommendationText strong, #smsText strong {
            color: #000000; 
            font-weight: 700;
        }
        .dark #recommendationText strong, .dark #smsText strong { color: #ffffff; }
        
        #recommendationText a {
            color: #485484;
            font-weight: 600;
            text-decoration: underline;
            text-underline-offset: 3px;
        }
        .dark #recommendationText a { color: #c6a777; }

        .tab-active {
            border-color: #485484;
            color: #485484;
            font-weight: 700;
        }
        .dark .tab-active {
            border-color: #c6a777;
            color: #c6a777;
        }

        /* Modern Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-gray-900 min-h-screen flex items-center justify-center p-4 transition-colors duration-300">

    <div class="bg-white dark:bg-gray-800 w-full max-w-7xl rounded-3xl shadow-2xl flex flex-col md:flex-row overflow-hidden h-[92vh] transition-colors duration-300 border border-slate-200 dark:border-gray-700">
        
        <!-- Sidebar / Inputs -->
        <div class="w-full md:w-1/3 bg-slate-50/50 dark:bg-gray-900/40 p-8 border-r border-slate-200 dark:border-gray-700 flex flex-col overflow-y-auto">
            <div class="mb-10">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <img src="https://tempo.fit/_next/image?url=https%3A%2F%2Fwww.datocms-assets.com%2F135987%2F1758652384-image-5-photoroom-2.jpeg&w=1920&q=80" alt="Tempo Logo" class="h-7 w-auto">
                        <h1 class="text-lg font-bold text-gray-900 dark:text-white tracking-tight">FITNESS OPS</h1>
                    </div>
                    <button id="theme-toggle" class="p-2.5 rounded-2xl bg-white dark:bg-gray-800 shadow-sm border border-slate-200 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-slate-50 dark:hover:bg-gray-700 transition-all">
                        <svg id="sun-icon" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                        <svg id="moon-icon" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                    </button>
                </div>
            </div>

            <div class="space-y-8 flex-grow">
                <div>
                    <label class="block text-[11px] font-bold text-slate-500 dark:text-gray-400 uppercase tracking-[0.15em] mb-3">Member Goals</label>
                    <textarea id="goals" rows="3" class="w-full p-4 text-sm border border-slate-200 dark:border-gray-700 rounded-2xl bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-tempo-indigo/20 focus:border-tempo-indigo transition-all outline-none resize-none" placeholder="e.g. Weight loss + Yoga for breathing"></textarea>
                </div>
                
                <div>
                    <label class="block text-[11px] font-bold text-slate-500 dark:text-gray-400 uppercase tracking-[0.15em] mb-3">Lifestyle & Equipment</label>
                    <textarea id="preferences" rows="3" class="w-full p-4 text-sm border border-slate-200 dark:border-gray-700 rounded-2xl bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-tempo-indigo/20 focus:border-tempo-indigo transition-all outline-none resize-none" placeholder="e.g. 20-30 mins, has dumbbells only"></textarea>
                </div>

                <div>
                    <label class="block text-[11px] font-bold text-slate-500 dark:text-gray-400 uppercase tracking-[0.15em] mb-3">Symptoms & Physicality</label>
                    <textarea id="symptoms" rows="3" class="w-full p-4 text-sm border border-slate-200 dark:border-gray-700 rounded-2xl bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-tempo-indigo/20 focus:border-tempo-indigo transition-all outline-none resize-none" placeholder="e.g. Knee discomfort, desk worker posture"></textarea>
                </div>
            </div>

            <div class="mt-10">
                <button id="generate-btn" class="w-full bg-tempo-indigo text-white font-bold py-4 px-6 rounded-2xl shadow-lg hover:bg-tempo-green hover:shadow-tempo-green/20 hover:-translate-y-0.5 active:translate-y-0 transition-all flex justify-center items-center">
                    <span id="btn-text">GENERATE HYBRID PLAN</span>
                    <span id="loading-spinner" class="hidden ml-3">
                        <svg class="animate-spin h-5 w-5 text-white" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    </span>
                </button>
            </div>
        </div>

        <!-- Main Display -->
        <div class="w-full md:w-2/3 flex flex-col bg-white dark:bg-gray-800 relative">
            
            <!-- Tab Navigation -->
            <div id="tabs-header" class="hidden flex-shrink-0 border-b border-slate-100 dark:border-gray-700 bg-white dark:bg-gray-800 z-10">
                <nav class="flex space-x-10 px-10">
                    <button id="tab-recommendation" class="tab-active whitespace-nowrap py-6 px-1 border-b-2 text-[12px] tracking-wider transition-all uppercase">
                        Master Strategy
                    </button>
                    <button id="tab-sms" class="border-transparent text-slate-400 dark:text-gray-500 hover:text-slate-600 dark:hover:text-gray-300 whitespace-nowrap py-6 px-1 border-b-2 font-semibold text-[12px] tracking-wider transition-all uppercase">
                        Coach Melissa Drafts
                    </button>
                </nav>
            </div>

            <!-- Content Container -->
            <div class="flex-grow overflow-y-auto p-8 md:p-12 relative">
                
                <!-- Initial State -->
                <div id="welcome-state" class="h-full flex flex-col items-center justify-center text-center space-y-6">
                    <div class="p-6 bg-slate-50 dark:bg-gray-900/50 rounded-full text-tempo-indigo">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 opacity-20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 002-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                        </svg>
                    </div>
                    <div class="max-w-xs space-y-2">
                        <h2 class="text-xl font-bold text-slate-900 dark:text-white">Awaiting Input</h2>
                        <p class="text-sm text-slate-500 font-medium">I'm ready to mix and match Tempo content to create the perfect hybrid strategy.</p>
                    </div>
                </div>

                <!-- Error Container -->
                <div id="error-message" class="hidden bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-900/50 p-6 rounded-2xl mb-8 flex items-start space-x-4">
                    <div class="p-2 bg-red-100 dark:bg-red-900/50 rounded-lg">
                        <svg class="h-5 w-5 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>
                    </div>
                    <div>
                        <p class="font-bold text-red-900 dark:text-red-400 text-sm mb-1">Service Alert</p>
                        <span id="error-text" class="text-xs text-red-700 dark:text-red-300 font-medium leading-relaxed"></span>
                    </div>
                </div>

                <!-- Recommendation Panel -->
                <div id="content-recommendation" class="hidden">
                    <div id="recommendationText" class="prose-custom max-w-none pb-20"></div>
                </div>

                <!-- SMS Panel -->
                <div id="content-sms" class="hidden">
                    <div class="bg-indigo-50/50 dark:bg-indigo-900/10 border border-indigo-100 dark:border-indigo-900/30 p-8 rounded-3xl mb-12">
                        <div class="flex items-center space-x-2 mb-3">
                            <span class="text-[10px] font-bold text-tempo-indigo dark:text-tempo-gold uppercase tracking-[0.2em]">Voice Consistency</span>
                        </div>
                        <p class="text-sm text-slate-700 dark:text-gray-400 font-medium leading-relaxed italic">The following snippets use Coach Melissa's human-first tone. Use these to bridge the technical recommendation into a natural SMS conversation.</p>
                    </div>
                    <div id="smsText" class="prose-custom max-w-none pb-20"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        const generateBtn = document.getElementById('generate-btn');
        const btnText = document.getElementById('btn-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const welcomeState = document.getElementById('welcome-state');
        const tabsHeader = document.getElementById('tabs-header');
        const goalsInput = document.getElementById('goals');
        const preferencesInput = document.getElementById('preferences');
        const symptomsInput = document.getElementById('symptoms');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const contentRecommendation = document.getElementById('content-recommendation');
        const contentSms = document.getElementById('content-sms');
        const recommendationText = document.getElementById('recommendationText');
        const smsText = document.getElementById('smsText');
        const tabRecBtn = document.getElementById('tab-recommendation');
        const tabSmsBtn = document.getElementById('tab-sms');
        const themeToggle = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');

        // --- THEME ---
        const setDark = (isDark) => {
            document.documentElement.classList.toggle('dark', isDark);
            sunIcon.classList.toggle('hidden', isDark);
            moonIcon.classList.toggle('hidden', !isDark);
            localStorage.theme = isDark ? 'dark' : 'light';
        };
        const initialDark = localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
        setDark(initialDark);
        themeToggle.onclick = () => setDark(!document.documentElement.classList.contains('dark'));

        // --- TABS ---
        function switchTab(tab) {
            contentRecommendation.classList.toggle('hidden', tab !== 'recommendation');
            contentSms.classList.toggle('hidden', tab !== 'sms');
            tabRecBtn.className = tab === 'recommendation' ? "tab-active whitespace-nowrap py-6 px-1 border-b-2 text-[12px] tracking-wider transition-all uppercase" : "border-transparent text-slate-400 dark:text-gray-500 hover:text-slate-600 dark:hover:text-gray-300 whitespace-nowrap py-6 px-1 border-b-2 font-semibold text-[12px] tracking-wider transition-all uppercase";
            tabSmsBtn.className = tab === 'sms' ? "tab-active whitespace-nowrap py-6 px-1 border-b-2 text-[12px] tracking-wider transition-all uppercase" : "border-transparent text-slate-400 dark:text-gray-500 hover:text-slate-600 dark:hover:text-gray-300 whitespace-nowrap py-6 px-1 border-b-2 font-semibold text-[12px] tracking-wider transition-all uppercase";
        }
        tabRecBtn.onclick = () => switchTab('recommendation');
        tabSmsBtn.onclick = () => switchTab('sms');

        // --- KNOWLEDGE BASE ---
        const knowledgeBase = {
            referenceLinks: {
                "Get Strong": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1385693249/Get+Strong",
                "Improve Definition": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1387855920/Improve+definition",
                "Lose Weight": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1387397155/Lose+Weight+and+Getting+Healthier",
                "Fitness Tips": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1388281898/Fitness+Tips",
                "General Inquiries": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1385955438/General+Fitness+Inquiries",
                "Pre/Post-Natal": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1386086563/Pre+Post-Natal+Inquiry",
                "Nutrition": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1386217627/Nutrition+Inquiries",
                "Injuries": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/1387397209/Injuries+Inquiries",
                "Calorie FAQ": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/130875393/FAQ+Calorie+Estimations+and+Heart+Rate+Training",
                "Fitness FAQ": "https://tempofit.atlassian.net/wiki/spaces/CS/pages/294917/Fitness+FAQ",
                "Tempo Blog": "https://tempo.fit/blog"
            }
        };

        const systemPrompt = `
You are the "Tempo Expert Orchestrator". 
Mission: Create advanced hybrid training schedules for Tempo members that agents can use.

LOGIC RULES:
1. **Hybrid Planning**: Mix and match programs to meet all member needs (e.g. if weight loss + breathing, pair a HIIT program with a mobility/recovery program).
2. **Structuring**: Use Markdown headings (## and ###) to organize the plan. Make it clean and easy for an agent to read.
3. **Hyperlinks**: You MUST hyperlink every mention of a Tempo SOP or category to its corresponding URL in the knowledge base.
4. **Coach Melissa Voice**: In the SMS section, provide natural snippets. Be warm, avoid sounding like a bot.

FORMAT:
## Strategy Overview
[1-2 sentences on the client's mix of goals]

## Recommendation Summary
[The specific programs selected + Why the mix works]

## Weekly Training Schedule
[A structured Mon-Sun plan]

## Expert Tips & SOP Logic
[Reference specific SOP logic - e.g. hypertrophy rep ranges or medical clearance warnings]

---SMS_SECTION---
[3 snippets from Coach Melissa]
`;

        generateBtn.onclick = async () => {
            setLoading(true);
            errorMessage.classList.add('hidden');
            const userQuery = `GOALS: ${goalsInput.value}\nLIFESTYLE: ${preferencesInput.value}\nSYMPTOMS: ${symptomsInput.value}\nCreate Hybrid Plan with structure. Hyperlink SOPs. Separator: ---SMS_SECTION---`;

            try {
                const apiKey = ""; // API Key provided by environment
                const model = "gemini-2.5-flash-preview-09-2025";
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: { parts: [{ text: systemPrompt + JSON.stringify(knowledgeBase) }] },
                        tools: [{ "google_search": {} }]
                    })
                });
                
                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(errorBody.error?.message || `Error ${response.status}`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) throw new Error("No recommendation was generated.");

                const [rec, sms] = text.split('---SMS_SECTION---');
                recommendationText.innerHTML = marked.parse(rec || "Unable to parse strategy.");
                smsText.innerHTML = marked.parse(sms || "Unable to parse SMS drafts.");

                welcomeState.classList.add('hidden');
                tabsHeader.classList.remove('hidden');
                switchTab('recommendation');
            } catch (error) {
                errorText.textContent = error.message;
                errorMessage.classList.remove('hidden');
            } finally {
                setLoading(false);
            }
        };

        function setLoading(isLoading) {
            generateBtn.disabled = isLoading;
            btnText.textContent = isLoading ? "ANALYZING..." : "GENERATE HYBRID PLAN";
            loadingSpinner.classList.toggle('hidden', !isLoading);
        }
    </script>
</body>
</html>
